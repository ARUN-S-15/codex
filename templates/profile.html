<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - CODEX</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style/main.css') }}">
    <style>
        .profile-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
        }
        
        .profile-header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 30px;
        }
        
        .profile-picture-container {
            position: relative;
        }
        
        .profile-picture {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid #5046e4;
        }
        
        .upload-overlay {
            position: absolute;
            bottom: 0;
            right: 0;
            background: #5046e4;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-overlay:hover {
            background: #3d36b8;
            transform: scale(1.1);
        }
        
        .profile-info h1 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .profile-info p {
            margin: 5px 0;
            color: #666;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .badge-verified {
            background: #4CAF50;
            color: white;
        }
        
        .badge-unverified {
            background: #ff9800;
            color: white;
        }
        
        .badge-admin {
            background: #9C27B0;
            color: white;
        }
        
        .badge-oauth {
            background: #2196F3;
            color: white;
        }
        
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: #5046e4;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        .profile-actions {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .profile-actions h2 {
            margin-top: 0;
            color: #333;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .btn-action {
            padding: 15px 25px;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: block;
            text-align: center;
        }
        
        .btn-primary {
            background: #5046e4;
            color: white;
        }
        
        .btn-primary:hover {
            background: #3d36b8;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #d0d0d0;
        }
        
        #uploadInput {
            display: none;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-left">
            <h1 class="logo">CODEX</h1>
        </div>
        <div class="nav-right">
            <span class="username">{{ session['username'] }}</span>
            <a href="{{ url_for('logout') }}" class="btn-logout">Logout</a>
        </div>
    </nav>
    
    <div class="profile-container">
        <div class="profile-header">
            <div class="profile-picture-container">
                <img src="{{ user.profile_picture or 'https://via.placeholder.com/150?text=' + user.username[0].upper() }}" 
                     alt="Profile Picture" 
                     class="profile-picture" 
                     id="profilePic">
                <label for="uploadInput" class="upload-overlay" title="Upload new picture">
                    ðŸ“·
                </label>
                <input type="file" id="uploadInput" accept="image/*">
            </div>
            
            <div class="profile-info">
                <h1>
                    {{ user.username }}
                    {% if user.is_admin %}
                    <span class="badge badge-admin">ADMIN</span>
                    {% endif %}
                </h1>
                <p>
                    {{ user.email }}
                    {% if user.email_verified %}
                    <span class="badge badge-verified">âœ“ Verified</span>
                    {% else %}
                    <span class="badge badge-unverified">âš  Not Verified</span>
                    {% endif %}
                </p>
                {% if user.oauth_provider %}
                <p><span class="badge badge-oauth">{{ user.oauth_provider | title }} Account</span></p>
                {% endif %}
                <p style="color: #999; font-size: 14px;">
                    Member since {{ user.created_at.strftime('%B %Y') }}
                    {% if user.last_login %}
                    â€¢ Last login: {{ user.last_login.strftime('%Y-%m-%d %H:%M') }}
                    {% endif %}
                </p>
            </div>
        </div>
        
        <div class="profile-stats">
            <div class="stat-card">
                <div class="stat-number">{{ user.total_activities }}</div>
                <div class="stat-label">Total Activities</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ user.total_projects }}</div>
                <div class="stat-label">Saved Projects</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ user.total_shared }}</div>
                <div class="stat-label">Shared Codes</div>
            </div>
        </div>
        
        <div class="profile-actions">
            <h2>Account Settings</h2>
            <div class="action-buttons">
                {% if not user.oauth_provider %}
                <a href="{{ url_for('change_password') }}" class="btn-action btn-primary">Change Password</a>
                {% endif %}
                <a href="{{ url_for('main') }}" class="btn-action btn-primary">Go to IDE</a>
                <a href="{{ url_for('practice_page') }}" class="btn-action btn-primary">Practice Problems</a>
                {% if user.is_admin %}
                <a href="{{ url_for('admin_dashboard') }}" class="btn-action btn-primary">Admin Dashboard</a>
                {% endif %}
                <a href="{{ url_for('logout') }}" class="btn-action btn-secondary">Logout</a>
            </div>
        </div>
    </div>
    
    <script>
        // Handle profile picture upload
        document.getElementById('uploadInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            // Validate file size (5MB max)
            if (file.size > 5 * 1024 * 1024) {
                alert('File size must be less than 5MB!');
                return;
            }
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file!');
                return;
            }
            
            const formData = new FormData();
            formData.append('profile_picture', file);
            
            fetch('/profile/upload-picture', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('profilePic').src = data.picture_url;
                    alert('Profile picture updated successfully!');
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Upload error:', error);
                alert('Failed to upload image. Please try again.');
            });
        });
    </script>
</body>
</html>
